{{/*
Cross-Category Links Partial
Creates "Also Available As" links and cross-category product discovery
*/}}

{{ $families := .Site.Data.product_families.families }}
{{ $currentFamily := .Params.product_family }}
{{ $currentCategory := .Section }}
{{ $currentSlug := .Params.slug | default "" }}

{{ if $currentFamily }}
  {{ $family := index $families $currentFamily }}
  {{ if $family }}
    {{ $availableCategories := $family.available_in }}
    {{ if gt (len $availableCategories) 1 }}
      
      <div class="cross-category-links">
        <div class="cross-category-header">
          <h3>{{ $family.name }} √©galement disponible en</h3>
          <p class="header-description">
            D√©couvrez comment la gamme {{ $family.name }} s'adapte √† diff√©rents usages
          </p>
        </div>

        <div class="category-transformations">
          {{ range $category, $categoryData := $availableCategories }}
            {{ if ne $category $currentCategory }}
              <div class="transformation-card" data-category="{{ $category }}">
                <div class="transformation-header">
                  <div class="category-info">
                    <h4 class="category-name">
                      {{ $category | title | replaceRE "-" " " }}
                      {{ if $categoryData.primary }}
                        <span class="primary-indicator">‚òÖ Principal</span>
                      {{ end }}
                    </h4>
                    <span class="product-count">{{ len $categoryData.products }} produits</span>
                  </div>
                  
                  <div class="category-icon">
                    {{ if eq $category "lits-tiroirs" }}
                      üõèÔ∏è
                    {{ else if eq $category "lits-gigogne" }}
                      üõå
                    {{ else if eq $category "canapes" }}
                      üõãÔ∏è
                    {{ else if eq $category "matelas" }}
                      üè≠
                    {{ else }}
                      üì¶
                    {{ end }}
                  </div>
                </div>

                <div class="transformation-description">
                  <p>{{ $categoryData.description }}</p>
                </div>

                {{/* Show specific products in this category */}}
                <div class="category-products">
                  {{ range first 3 $categoryData.products }}
                    {{ $productPage := $.Site.GetPage (printf "/%s/%s" $category .) }}
                    {{ if $productPage }}
                      <div class="product-preview">
                        <a href="{{ $productPage.RelPermalink }}" class="product-preview-link">
                          <div class="product-preview-content">
                            <h5 class="product-name">{{ $productPage.Title }}</h5>
                            {{ if $productPage.Params.subtitle }}
                              <p class="product-subtitle">{{ $productPage.Params.subtitle }}</p>
                            {{ end }}
                            
                            {{ if $productPage.Params.price_range }}
                              <div class="product-price">
                                {{ if (reflect.IsMap $productPage.Params.price_range) }}
                                  {{ $productPage.Params.price_range.min }}‚Ç¨ - {{ $productPage.Params.price_range.max }}‚Ç¨
                                {{ else }}
                                  {{ $productPage.Params.price_range }}
                                {{ end }}
                              </div>
                            {{ end }}

                            {{ if $productPage.Params.key_features }}
                              <ul class="preview-features">
                                {{ range first 2 $productPage.Params.key_features }}
                                  <li>{{ . }}</li>
                                {{ end }}
                              </ul>
                            {{ end }}
                          </div>
                          
                          {{ if $productPage.Params.images }}
                            <div class="product-preview-image">
                              <img src="{{ (index $productPage.Params.images 0).url }}" 
                                   alt="{{ $productPage.Title }}" 
                                   loading="lazy">
                            </div>
                          {{ end }}
                        </a>
                      </div>
                    {{ end }}
                  {{ end }}
                  
                  {{ if gt (len $categoryData.products) 3 }}
                    <div class="more-products">
                      <a href="/{{ $category }}#famille-{{ $currentFamily }}" class="more-link">
                        Voir {{ sub (len $categoryData.products) 3 }} autres produits
                      </a>
                    </div>
                  {{ end }}
                </div>

                <div class="transformation-cta">
                  <a href="/{{ $category }}" class="category-cta-button">
                    D√©couvrir en {{ $category | title | replaceRE "-" " " }}
                  </a>
                </div>
              </div>
            {{ end }}
          {{ end }}
        </div>

        {{/* Usage Scenarios (if available) */}}
        {{ if $family.transformation_modes }}
          <div class="usage-scenarios">
            <h4>Modes d'utilisation</h4>
            <div class="scenarios-grid">
              {{ range $family.transformation_modes }}
                <div class="scenario-card">
                  <div class="scenario-mode">{{ .mode | replaceRE "_" " " | title }}</div>
                  <div class="scenario-capacity">{{ .capacity }}</div>
                  <div class="scenario-use-case">{{ .use_case | title }}</div>
                </div>
              {{ end }}
            </div>
          </div>
        {{ end }}

        {{/* Family Comparison */}}
        {{ if $family.cross_selling.complementary_families }}
          <div class="family-comparison">
            <h4>Comparer avec d'autres gammes</h4>
            <div class="comparison-grid">
              {{ range $family.cross_selling.complementary_families }}
                {{ $compFamily := index $families . }}
                {{ if $compFamily }}
                  <div class="comparison-card">
                    <div class="comparison-header">
                      <h5>{{ $compFamily.name }}</h5>
                      <span class="positioning-tag">{{ $compFamily.positioning | title }}</span>
                    </div>
                    
                    <div class="comparison-highlights">
                      <div class="highlight-item">
                        <span class="highlight-label">Prix:</span>
                        <span class="highlight-value">{{ $compFamily.price_range.min }}‚Ç¨ - {{ $compFamily.price_range.max }}‚Ç¨</span>
                      </div>
                      
                      {{ if $compFamily.variants }}
                        <div class="highlight-item">
                          <span class="highlight-label">Variantes:</span>
                          <span class="highlight-value">{{ len $compFamily.variants }}</span>
                        </div>
                      {{ end }}
                      
                      <div class="highlight-item">
                        <span class="highlight-label">Cat√©gories:</span>
                        <span class="highlight-value">{{ len $compFamily.available_in }}</span>
                      </div>
                    </div>

                    <p class="comparison-description">{{ $compFamily.description }}</p>
                    
                    <div class="comparison-categories">
                      {{ range $category, $categoryData := $compFamily.available_in }}
                        <a href="/{{ $category }}" class="comparison-category-link">
                          {{ $category | title | replaceRE "-" " " }}
                        </a>
                      {{ end }}
                    </div>
                  </div>
                {{ end }}
              {{ end }}
            </div>
          </div>
        {{ end }}

        {{/* Quick Actions */}}
        <div class="quick-actions">
          <div class="action-buttons">
            <a href="/collections/{{ $currentFamily }}" class="action-button primary">
              Voir toute la gamme {{ $family.name }}
            </a>
            <a href="/collections" class="action-button secondary">
              Toutes les collections
            </a>
            {{ if $family.cross_selling.accessories }}
              <a href="/accessoires" class="action-button tertiary">
                Accessoires compatibles
              </a>
            {{ end }}
          </div>
        </div>
      </div>

      {{/* Cross-Category Links Styles */}}
      <style>
        .cross-category-links {
          background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
          border-radius: 12px;
          padding: 2rem;
          margin: 3rem 0;
          border: 1px solid #e2e8f0;
        }
        
        .cross-category-header {
          text-align: center;
          margin-bottom: 2.5rem;
        }
        
        .cross-category-header h3 {
          color: #2c5282;
          font-size: 1.75rem;
          font-weight: 700;
          margin: 0 0 0.75rem 0;
        }
        
        .header-description {
          color: #4a5568;
          font-size: 1.1rem;
          margin: 0;
          line-height: 1.5;
        }
        
        .category-transformations {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
          gap: 2rem;
          margin-bottom: 2.5rem;
        }
        
        .transformation-card {
          background: white;
          border-radius: 10px;
          border: 1px solid #e2e8f0;
          overflow: hidden;
          box-shadow: 0 4px 6px rgba(0,0,0,0.05);
          transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .transformation-card:hover {
          transform: translateY(-4px);
          box-shadow: 0 12px 25px rgba(0,0,0,0.1);
        }
        
        .transformation-header {
          background: #2c5282;
          color: white;
          padding: 1.5rem;
          display: flex;
          align-items: center;
          justify-content: space-between;
        }
        
        .category-name {
          font-size: 1.25rem;
          font-weight: 700;
          margin: 0 0 0.25rem 0;
        }
        
        .primary-indicator {
          font-size: 0.8rem;
          background: #38a169;
          padding: 0.125rem 0.5rem;
          border-radius: 10px;
          margin-left: 0.5rem;
        }
        
        .product-count {
          font-size: 0.9rem;
          opacity: 0.9;
        }
        
        .category-icon {
          font-size: 2rem;
        }
        
        .transformation-description {
          padding: 1.25rem 1.5rem;
          border-bottom: 1px solid #f7fafc;
        }
        
        .transformation-description p {
          margin: 0;
          color: #4a5568;
          line-height: 1.6;
          font-style: italic;
        }
        
        .category-products {
          padding: 1.5rem;
        }
        
        .product-preview {
          margin-bottom: 1.25rem;
          padding-bottom: 1.25rem;
          border-bottom: 1px solid #f7fafc;
        }
        
        .product-preview:last-of-type {
          border-bottom: none;
          margin-bottom: 0.75rem;
        }
        
        .product-preview-link {
          display: flex;
          align-items: flex-start;
          gap: 1rem;
          text-decoration: none;
          color: inherit;
          transition: all 0.2s;
        }
        
        .product-preview-link:hover {
          transform: translateX(4px);
        }
        
        .product-preview-content {
          flex: 1;
        }
        
        .product-name {
          color: #2c5282;
          font-size: 1rem;
          font-weight: 600;
          margin: 0 0 0.5rem 0;
          line-height: 1.3;
        }
        
        .product-subtitle {
          color: #4a5568;
          font-size: 0.875rem;
          margin: 0 0 0.5rem 0;
          line-height: 1.4;
        }
        
        .product-price {
          color: #38a169;
          font-weight: 600;
          font-size: 0.9rem;
          margin-bottom: 0.5rem;
        }
        
        .preview-features {
          list-style: none;
          padding: 0;
          margin: 0;
        }
        
        .preview-features li {
          color: #4a5568;
          font-size: 0.8rem;
          margin-bottom: 0.25rem;
          position: relative;
          padding-left: 1rem;
        }
        
        .preview-features li:before {
          content: "‚úì";
          position: absolute;
          left: 0;
          color: #38a169;
          font-weight: 700;
        }
        
        .product-preview-image {
          width: 80px;
          height: 60px;
          border-radius: 6px;
          overflow: hidden;
          background: #f7fafc;
          flex-shrink: 0;
        }
        
        .product-preview-image img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }
        
        .more-products {
          text-align: center;
          padding-top: 0.75rem;
        }
        
        .more-link {
          color: #2c5282;
          text-decoration: none;
          font-weight: 600;
          font-size: 0.9rem;
        }
        
        .more-link:hover {
          text-decoration: underline;
        }
        
        .transformation-cta {
          padding: 1.5rem;
          background: #f7fafc;
          text-align: center;
        }
        
        .category-cta-button {
          display: inline-block;
          background: #2c5282;
          color: white;
          padding: 0.75rem 1.5rem;
          border-radius: 8px;
          text-decoration: none;
          font-weight: 600;
          transition: all 0.2s;
        }
        
        .category-cta-button:hover {
          background: #2a4d82;
          transform: translateY(-2px);
        }
        
        .usage-scenarios {
          margin-bottom: 2.5rem;
        }
        
        .usage-scenarios h4 {
          color: #2c5282;
          font-size: 1.25rem;
          font-weight: 700;
          margin: 0 0 1rem 0;
          text-align: center;
        }
        
        .scenarios-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1rem;
        }
        
        .scenario-card {
          background: white;
          border: 1px solid #e2e8f0;
          border-radius: 8px;
          padding: 1.25rem;
          text-align: center;
          transition: transform 0.2s;
        }
        
        .scenario-card:hover {
          transform: translateY(-2px);
        }
        
        .scenario-mode {
          color: #2c5282;
          font-weight: 700;
          font-size: 1rem;
          margin-bottom: 0.5rem;
        }
        
        .scenario-capacity {
          color: #38a169;
          font-weight: 600;
          margin-bottom: 0.25rem;
        }
        
        .scenario-use-case {
          color: #4a5568;
          font-size: 0.875rem;
        }
        
        .family-comparison h4 {
          color: #2c5282;
          font-size: 1.25rem;
          font-weight: 700;
          margin: 0 0 1.25rem 0;
          text-align: center;
        }
        
        .comparison-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
          gap: 1.5rem;
          margin-bottom: 2rem;
        }
        
        .comparison-card {
          background: white;
          border: 1px solid #e2e8f0;
          border-radius: 8px;
          padding: 1.5rem;
          transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .comparison-card:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .comparison-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 1rem;
        }
        
        .comparison-header h5 {
          color: #2c5282;
          font-size: 1.1rem;
          font-weight: 700;
          margin: 0;
        }
        
        .positioning-tag {
          background: #e2e8f0;
          color: #4a5568;
          padding: 0.25rem 0.75rem;
          border-radius: 15px;
          font-size: 0.75rem;
          font-weight: 600;
        }
        
        .comparison-highlights {
          margin-bottom: 1rem;
        }
        
        .highlight-item {
          display: flex;
          justify-content: space-between;
          margin-bottom: 0.5rem;
          font-size: 0.875rem;
        }
        
        .highlight-label {
          color: #4a5568;
          font-weight: 600;
        }
        
        .highlight-value {
          color: #2c5282;
          font-weight: 600;
        }
        
        .comparison-description {
          color: #4a5568;
          font-size: 0.875rem;
          line-height: 1.4;
          margin: 0 0 1rem 0;
        }
        
        .comparison-categories {
          display: flex;
          flex-wrap: wrap;
          gap: 0.5rem;
        }
        
        .comparison-category-link {
          padding: 0.25rem 0.75rem;
          background: #f7fafc;
          border: 1px solid #e2e8f0;
          border-radius: 15px;
          text-decoration: none;
          color: #4a5568;
          font-size: 0.75rem;
          transition: all 0.2s;
        }
        
        .comparison-category-link:hover {
          border-color: #2c5282;
          color: #2c5282;
        }
        
        .quick-actions {
          text-align: center;
        }
        
        .action-buttons {
          display: flex;
          justify-content: center;
          gap: 1rem;
          flex-wrap: wrap;
        }
        
        .action-button {
          padding: 0.75rem 1.5rem;
          border-radius: 8px;
          text-decoration: none;
          font-weight: 600;
          transition: all 0.2s;
        }
        
        .action-button.primary {
          background: #2c5282;
          color: white;
        }
        
        .action-button.primary:hover {
          background: #2a4d82;
          transform: translateY(-2px);
        }
        
        .action-button.secondary {
          background: white;
          color: #2c5282;
          border: 2px solid #2c5282;
        }
        
        .action-button.secondary:hover {
          background: #2c5282;
          color: white;
        }
        
        .action-button.tertiary {
          background: #f7fafc;
          color: #4a5568;
          border: 1px solid #e2e8f0;
        }
        
        .action-button.tertiary:hover {
          border-color: #2c5282;
          color: #2c5282;
        }
        
        @media (max-width: 768px) {
          .cross-category-links {
            padding: 1.5rem;
          }
          
          .category-transformations {
            grid-template-columns: 1fr;
          }
          
          .transformation-header {
            flex-direction: column;
            text-align: center;
            gap: 0.75rem;
          }
          
          .product-preview-link {
            flex-direction: column;
            text-align: center;
          }
          
          .product-preview-image {
            width: 100%;
            height: 120px;
            align-self: center;
          }
          
          .comparison-grid,
          .scenarios-grid {
            grid-template-columns: 1fr;
          }
          
          .action-buttons {
            flex-direction: column;
            align-items: center;
          }
          
          .action-button {
            width: 100%;
            max-width: 300px;
          }
        }
      </style>
    {{ end }}
  {{ end }}
{{ end }}